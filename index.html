<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¶ Batch Inventory System</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì¶</text></svg>">
    
    <style>
        /* RESET & BASE */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8fafc; color: #1e293b; line-height: 1.4; }
        .container { max-width: 1200px; margin: 0 auto; padding: 12px; }
        
        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 10px 0; border-bottom: 1px solid #e2e8f0; }
        .header h1 { font-size: 1.5rem; font-weight: 600; color: #2563eb; display: flex; align-items: center; gap: 8px; }
        
        /* SETUP MODAL */
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .modal-content { background: white; border-radius: 8px; padding: 24px; max-width: 500px; width: 100%; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
        .modal h3 { margin-bottom: 15px; color: #2563eb; }
        .modal p { margin-bottom: 10px; color: #64748b; }
        .modal ol { margin: 10px 0 20px 20px; }
        .modal li { margin-bottom: 5px; }
        .modal input { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 4px; margin: 10px 0; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        
        /* BUTTONS */
        .btn { padding: 8px 16px; border: none; border-radius: 4px; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-secondary { background: #64748b; color: white; }
        .btn-secondary:hover { background: #475569; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        
        /* STATUS */
        .status-bar { background: #f1f5f9; padding: 8px 15px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; color: #64748b; }
        .status-badge { padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; }
        .status-online { background: #10b981; color: white; }
        .status-offline { background: #ef4444; color: white; }
        
        /* CURRENT BATCH */
        .current-batch { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 2px solid #2563eb; }
        .batch-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .batch-title { font-size: 1.1rem; font-weight: 600; color: #2563eb; }
        .batch-actions { display: flex; gap: 8px; }
        
        /* ADD FORM */
        .add-form { background: #f8fafc; border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .form-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .form-group { display: flex; flex-direction: column; }
        .form-label { font-size: 0.75rem; font-weight: 600; color: #64748b; margin-bottom: 4px; text-transform: uppercase; }
        input, select { width: 100%; padding: 8px 10px; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 0.875rem; }
        input:focus, select:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1); }
        #nameInput, #detailsInput, #groupInput { text-transform: uppercase; }
        
        /* BATCH TABLE */
        .batch-table { background: white; border-radius: 8px; overflow: hidden; margin-bottom: 10px; }
        .table-header { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 0.5fr; background: #f1f5f9; padding: 12px 15px; font-weight: 600; font-size: 0.75rem; color: #64748b; text-transform: uppercase; border-bottom: 1px solid #e2e8f0; }
        .table-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 0.5fr; padding: 12px 15px; border-bottom: 1px solid #e2e8f0; align-items: center; }
        .table-row:hover { background: #f8fafc; }
        .item-name { font-weight: 600; text-transform: uppercase; font-size: 0.875rem; }
        .item-quantity { font-weight: 700; color: #2563eb; text-align: center; }
        .item-group { background: #e0f2fe; color: #0369a1; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; }
        
        /* PENDING BATCHES */
        .pending-section { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .pending-header { font-size: 1.1rem; font-weight: 600; color: #f59e0b; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .pending-batch { background: #fffbeb; border: 2px solid #fbbf24; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .pending-batch-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 2px solid #fbbf24; }
        .pending-batch-title { font-weight: 600; color: #d97706; }
        .pending-batch-actions { display: flex; gap: 8px; }
        
        /* APPROVED INVENTORY */
        .inventory-section { background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .inventory-header { font-size: 1.1rem; font-weight: 600; color: #10b981; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        
        /* UTILITY */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .empty-state { text-align: center; padding: 40px 20px; color: #64748b; }
        .empty-icon { font-size: 2rem; margin-bottom: 10px; opacity: 0.5; }
        
        /* EDITABLE */
        .editable { cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background 0.2s; }
        .editable:hover { background: #f1f5f9; }
        .editing { background: #fff; border: 1px solid #2563eb; }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .table-header, .table-row { grid-template-columns: 2fr 1fr 1fr 0.5fr; }
            .item-details { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1><span>üì¶</span> Batch Inventory System</h1>
            <div>
                <button id="adminBtn" class="btn btn-secondary">üîê Admin</button>
                <button id="logoutBtn" class="btn btn-secondary hidden">üö™ Logout</button>
            </div>
        </div>

        <!-- SETUP MODAL -->
        <div id="setupModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>üîê Setup Required</h3>
                <p>This app needs a GitHub token to store your inventory data.</p>
                
                <p><strong>Step 1: Generate Token</strong></p>
                <ol>
                    <li>Go to <a href="https://github.com/settings/tokens" target="_blank">GitHub Tokens</a></li>
                    <li>Click <strong>"Generate new token"</strong></li>
                    <li>Token name: <code>Inventory-App</code></li>
                    <li>Expiration: <code>90 days</code></li>
                    <li>Select repositories: <code>inventory-data</code></li>
                    <li>Permissions: <strong>Contents: Read and write</strong></li>
                    <li>Click "Generate token"</li>
                    <li><strong>COPY the token</strong> (starts with github_pat_)</li>
                </ol>
                
                <p><strong>Step 2: Paste Token Here</strong></p>
                <input type="text" id="tokenInput" placeholder="Paste your GitHub token here">
                <p style="font-size: 0.75rem; color: #64748b;">Token is stored ONLY in your browser.</p>
                
                <div class="modal-buttons">
                    <button id="saveTokenBtn" class="btn btn-primary">Save Token</button>
                </div>
            </div>
        </div>

        <!-- STATUS BAR -->
        <div class="status-bar">
            <div class="stats">
                <span id="currentBatchCount">Current Batch: 0 items</span>
                <span>‚Ä¢</span>
                <span id="pendingBatchCount">Pending: 0 batches</span>
                <span>‚Ä¢</span>
                <span id="approvedCount">Approved: 0 items</span>
            </div>
            <div id="connectionStatus" class="status-badge status-online">Online</div>
        </div>

        <!-- CURRENT BATCH (Staff View) -->
        <div id="currentBatchSection" class="current-batch">
            <div class="batch-header">
                <div class="batch-title">üìù Current Batch</div>
                <div class="batch-actions">
                    <button id="clearBatchBtn" class="btn btn-danger">üóëÔ∏è Clear All</button>
                    <button id="submitBatchBtn" class="btn btn-success">üì§ Submit for Approval</button>
                </div>
            </div>
            
            <!-- ADD FORM -->
            <div class="add-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Item Name</label>
                        <input type="text" id="nameInput" placeholder="Type name..." autocapitalize="characters">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantity</label>
                        <input type="number" id="quantityInput" placeholder="0" min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Group</label>
                        <input type="text" id="groupInput" placeholder="Enter group..." autocapitalize="characters">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Details</label>
                        <input type="text" id="detailsInput" placeholder="Details..." autocapitalize="characters">
                    </div>
                </div>
                <button id="addBtn" class="btn btn-primary" style="width: 100%;">‚ûï Add to Batch</button>
            </div>

            <!-- CURRENT BATCH LIST -->
            <div class="batch-table">
                <div class="table-header">
                    <div>ITEM NAME</div>
                    <div class="text-center">QUANTITY</div>
                    <div class="text-center">GROUP</div>
                    <div>DETAILS</div>
                    <div class="text-right">ACTION</div>
                </div>
                <div id="currentBatchList">
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>No items in current batch</p>
                        <p>Add items above to start a new batch</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- PENDING BATCHES (Admin Only) -->
        <div id="pendingBatchesSection" class="pending-section hidden">
            <div class="pending-header">‚è≥ Pending Batches (Admin Review)</div>
            <div id="pendingBatchesList"></div>
        </div>

        <!-- APPROVED INVENTORY -->
        <div class="inventory-section">
            <div class="inventory-header">‚úÖ Approved Inventory</div>
            <div class="batch-table">
                <div class="table-header">
                    <div>ITEM NAME</div>
                    <div class="text-center">QUANTITY</div>
                    <div class="text-center">GROUP</div>
                    <div>DETAILS</div>
                    <div class="text-right">ACTION</div>
                </div>
                <div id="approvedInventoryList">
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>No approved items yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            GITHUB_USERNAME: 'unique205',
            DATA_REPO: 'inventory-data',
            DATA_FILE: 'data/inventory.json',
            BRANCH: 'main',
            ADMIN_PASSWORD: 'Arshiyan2@'
        };

        // Application state
        let currentBatch = [];
        let pendingBatches = [];
        let approvedInventory = [];
        let offlineQueue = [];
        let isOnline = navigator.onLine;
        let githubToken = null;
        let isAdmin = false;

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Starting app...');
            
            githubToken = localStorage.getItem('github_token');
            
            if (!githubToken) {
                showSetupModal();
            } else {
                initializeApp();
            }
            
            setupEventListeners();
        });

        // ============================================
        // SETUP MODAL
        // ============================================
        function showSetupModal() {
            const modal = document.getElementById('setupModal');
            modal.style.display = 'flex';
            
            document.getElementById('saveTokenBtn').addEventListener('click', saveToken);
            document.getElementById('tokenInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveToken();
            });
        }

        function saveToken() {
            const tokenInput = document.getElementById('tokenInput');
            const token = tokenInput.value.trim();
            
            if (!token) {
                alert('Please enter a token');
                return;
            }
            
            if (!token.startsWith('github_pat_') && !token.startsWith('ghp_')) {
                if (!confirm('Token should start with github_pat_ or ghp_. Continue?')) {
                    return;
                }
            }
            
            localStorage.setItem('github_token', token);
            githubToken = token;
            document.getElementById('setupModal').style.display = 'none';
            initializeApp();
        }

        // ============================================
        // APP INITIALIZATION
        // ============================================
        async function initializeApp() {
            console.log('üîå Testing GitHub connection...');
            
            const isValid = await testGitHubToken();
            
            if (isValid) {
                loadLocalData();
                updateUI();
                
                if (isOnline) {
                    await syncWithGitHub();
                }
                
                console.log('‚úÖ App ready');
            } else {
                localStorage.removeItem('github_token');
                githubToken = null;
                showSetupModal();
                alert('Invalid token. Please generate a new one.');
            }
        }

        async function testGitHubToken() {
            try {
                const testUrl = `https://api.github.com/repos/${CONFIG.GITHUB_USERNAME}/${CONFIG.DATA_REPO}`;
                const response = await fetch(testUrl, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.status === 401 || response.status === 403) {
                    return false;
                }
                
                return response.ok;
            } catch (error) {
                console.error('Token test failed:', error);
                return false;
            }
        }

        // ============================================
        // GITHUB OPERATIONS
        // ============================================
        async function syncWithGitHub() {
            if (!isOnline || !githubToken) return;
            
            updateStatus('Syncing...', 'syncing');
            
            try {
                if (offlineQueue.length > 0) {
                    await pushToGitHub();
                }
                
                await pullFromGitHub();
                
                updateStatus('Online', 'online');
                showMessage('‚úÖ Synced with GitHub');
                
            } catch (error) {
                console.error('Sync failed:', error);
                updateStatus('Sync failed', 'offline');
                showMessage('‚ùå Sync failed - Using local data');
            }
        }

        async function pushToGitHub() {
            let remoteData = { pendingBatches: [], approvedInventory: [] };
            try {
                remoteData = await readFromGitHub();
            } catch (e) {
                remoteData = { pendingBatches: [], approvedInventory: [] };
            }
            
            offlineQueue.forEach(action => {
                if (action.type === 'submitBatch') {
                    remoteData.pendingBatches.unshift(action.batch);
                } else if (action.type === 'approveBatch') {
                    const batchIndex = remoteData.pendingBatches.findIndex(b => b.id === action.batchId);
                    if (batchIndex !== -1) {
                        remoteData.pendingBatches.splice(batchIndex, 1);
                        remoteData.approvedInventory.push(...action.items);
                    }
                } else if (action.type === 'rejectBatch') {
                    const batchIndex = remoteData.pendingBatches.findIndex(b => b.id === action.batchId);
                    if (batchIndex !== -1) {
                        remoteData.pendingBatches.splice(batchIndex, 1);
                    }
                } else if (action.type === 'deleteItem') {
                    const itemIndex = remoteData.approvedInventory.findIndex(i => i.id === action.itemId);
                    if (itemIndex !== -1) {
                        remoteData.approvedInventory.splice(itemIndex, 1);
                    }
                } else if (action.type === 'updateItem') {
                    const itemIndex = remoteData.approvedInventory.findIndex(i => i.id === action.item.id);
                    if (itemIndex !== -1) {
                        remoteData.approvedInventory[itemIndex] = action.item;
                    }
                }
            });
            
            await writeToGitHub(remoteData);
            
            pendingBatches = remoteData.pendingBatches;
            approvedInventory = remoteData.approvedInventory;
            offlineQueue = [];
            saveLocalData();
        }

        async function pullFromGitHub() {
            const remoteData = await readFromGitHub();
            pendingBatches = remoteData.pendingBatches || [];
            approvedInventory = remoteData.approvedInventory || [];
            saveLocalData();
            updateUI();
        }

        async function readFromGitHub() {
            const url = `https://api.github.com/repos/${CONFIG.GITHUB_USERNAME}/${CONFIG.DATA_REPO}/contents/${CONFIG.DATA_FILE}`;
            
            const response = await fetch(url, {
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            if (response.status === 404) {
                return { pendingBatches: [], approvedInventory: [] };
            }
            
            if (!response.ok) {
                throw new Error(`GitHub read error: ${response.status}`);
            }
            
            const data = await response.json();
            const content = atob(data.content.replace(/\n/g, ''));
            return JSON.parse(content);
        }

        async function writeToGitHub(data) {
            const url = `https://api.github.com/repos/${CONFIG.GITHUB_USERNAME}/${CONFIG.DATA_REPO}/contents/${CONFIG.DATA_FILE}`;
            
            let sha = null;
            try {
                const infoResponse = await fetch(url, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                if (infoResponse.ok) {
                    const info = await infoResponse.json();
                    sha = info.sha;
                }
            } catch (e) {
                // File doesn't exist
            }
            
            const content = btoa(JSON.stringify(data, null, 2));
            const body = {
                message: `Batch update ${new Date().toLocaleString()}`,
                content: content,
                branch: CONFIG.BRANCH
            };
            
            if (sha) {
                body.sha = sha;
            }
            
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });
            
            if (!response.ok) {
                throw new Error(`GitHub write error: ${response.status}`);
            }
            
            return await response.json();
        }

        // ============================================
        // LOCAL DATA MANAGEMENT
        // ============================================
        function loadLocalData() {
            const savedCurrent = localStorage.getItem('current_batch');
            if (savedCurrent) {
                try {
                    currentBatch = JSON.parse(savedCurrent);
                } catch (e) {
                    currentBatch = [];
                }
            }
            
            const savedPending = localStorage.getItem('pending_batches');
            if (savedPending) {
                try {
                    pendingBatches = JSON.parse(savedPending);
                } catch (e) {
                    pendingBatches = [];
                }
            }
            
            const savedApproved = localStorage.getItem('approved_inventory');
            if (savedApproved) {
                try {
                    approvedInventory = JSON.parse(savedApproved);
                } catch (e) {
                    approvedInventory = [];
                }
            }
            
            const queue = localStorage.getItem('offline_queue');
            if (queue) {
                try {
                    offlineQueue = JSON.parse(queue);
                } catch (e) {
                    offlineQueue = [];
                }
            }
        }

        function saveLocalData() {
            localStorage.setItem('current_batch', JSON.stringify(currentBatch));
            localStorage.setItem('pending_batches', JSON.stringify(pendingBatches));
            localStorage.setItem('approved_inventory', JSON.stringify(approvedInventory));
            localStorage.setItem('offline_queue', JSON.stringify(offlineQueue));
        }

        // ============================================
        // BATCH OPERATIONS
        // ============================================
        function addItemToBatch() {
            const name = document.getElementById('nameInput').value.trim().toUpperCase();
            const quantity = parseInt(document.getElementById('quantityInput').value) || 0;
            const group = document.getElementById('groupInput').value.trim().toUpperCase();
            const details = document.getElementById('detailsInput').value.trim().toUpperCase();
            
            if (!name || !quantity || !group) {
                showMessage('‚ö†Ô∏è Please fill all required fields');
                return;
            }
            
            const newItem = {
                id: 'item_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: name,
                quantity: quantity,
                group: group,
                details: details,
                addedAt: new Date().toISOString()
            };
            
            currentBatch.unshift(newItem);
            
            document.getElementById('nameInput').value = '';
            document.getElementById('quantityInput').value = '';
            document.getElementById('groupInput').value = '';
            document.getElementById('detailsInput').value = '';
            document.getElementById('nameInput').focus();
            
            saveLocalData();
            updateUI();
            showMessage('‚úÖ Item added to batch');
        }

        function removeFromBatch(itemId) {
            const index = currentBatch.findIndex(item => item.id === itemId);
            if (index !== -1) {
                currentBatch.splice(index, 1);
                saveLocalData();
                updateUI();
                showMessage('üóëÔ∏è Item removed from batch');
            }
        }

        function clearBatch() {
            if (currentBatch.length === 0) return;
            
            if (confirm('Clear all items from current batch?')) {
                currentBatch = [];
                saveLocalData();
                updateUI();
                showMessage('üóëÔ∏è Batch cleared');
            }
        }

        async function submitBatch() {
            if (currentBatch.length === 0) {
                showMessage('‚ö†Ô∏è No items to submit');
                return;
            }
            
            if (!confirm(`Submit batch with ${currentBatch.length} items for approval?`)) {
                return;
            }
            
            const batch = {
                id: 'batch_' + Date.now(),
                items: [...currentBatch],
                submittedAt: new Date().toISOString(),
                submittedBy: 'Staff',
                status: 'pending'
            };
            
            pendingBatches.unshift(batch);
            currentBatch = [];
            
            offlineQueue.push({
                type: 'submitBatch',
                batch: batch
            });
            
            saveLocalData();
            updateUI();
            
            if (isOnline && githubToken) {
                await syncWithGitHub();
            }
            
            showMessage('‚úÖ Batch submitted for approval');
        }

        // ============================================
        // ADMIN OPERATIONS
        // ============================================
        async function approveBatch(batchId) {
            if (!confirm('Approve this entire batch?')) return;
            
            const batchIndex = pendingBatches.findIndex(b => b.id === batchId);
            if (batchIndex === -1) return;
            
            const batch = pendingBatches[batchIndex];
            
            // Add all items to approved inventory
            batch.items.forEach(item => {
                item.approvedAt = new Date().toISOString();
                item.approvedBy = 'Admin';
                approvedInventory.unshift(item);
            });
            
            pendingBatches.splice(batchIndex, 1);
            
            offlineQueue.push({
                type: 'rejectBatch',
                batchId: batchId
            });
            
            saveLocalData();
            updateUI();
            
            if (isOnline && githubToken) {
                await syncWithGitHub();
            }
            
            showMessage('‚ùå Batch rejected');
        }

        function editBatchItem(batchId, itemId, field) {
            const batch = pendingBatches.find(b => b.id === batchId);
            if (!batch) return;
            
            const item = batch.items.find(i => i.id === itemId);
            if (!item) return;
            
            const currentValue = item[field];
            const newValue = prompt(`Edit ${field}:`, currentValue);
            
            if (newValue !== null && newValue.trim() !== '') {
                item[field] = field === 'quantity' ? parseInt(newValue) : newValue.trim().toUpperCase();
                saveLocalData();
                updateUI();
                showMessage('‚úèÔ∏è Item updated');
            }
        }

        function removeBatchItem(batchId, itemId) {
            const batch = pendingBatches.find(b => b.id === batchId);
            if (!batch) return;
            
            const itemIndex = batch.items.findIndex(i => i.id === itemId);
            if (itemIndex === -1) return;
            
            if (confirm('Remove this item from batch?')) {
                batch.items.splice(itemIndex, 1);
                
                // If batch is empty, remove it
                if (batch.items.length === 0) {
                    const batchIndex = pendingBatches.findIndex(b => b.id === batchId);
                    pendingBatches.splice(batchIndex, 1);
                }
                
                saveLocalData();
                updateUI();
                showMessage('üóëÔ∏è Item removed');
            }
        }

        async function deleteApprovedItem(itemId) {
            if (!confirm('Delete this approved item?')) return;
            
            const itemIndex = approvedInventory.findIndex(item => item.id === itemId);
            if (itemIndex === -1) return;
            
            approvedInventory.splice(itemIndex, 1);
            
            offlineQueue.push({
                type: 'deleteItem',
                itemId: itemId
            });
            
            saveLocalData();
            updateUI();
            
            if (isOnline && githubToken) {
                await syncWithGitHub();
            }
            
            showMessage('‚úÖ Item deleted');
        }

        // ============================================
        // UI UPDATES
        // ============================================
        function updateUI() {
            updateCurrentBatchList();
            updatePendingBatchesList();
            updateApprovedInventoryList();
            updateStats();
            updateAdminUI();
        }

        function updateCurrentBatchList() {
            const container = document.getElementById('currentBatchList');
            
            if (currentBatch.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>No items in current batch</p>
                        <p>Add items above to start a new batch</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = currentBatch.map(item => `
                <div class="table-row">
                    <div class="item-name">${item.name}</div>
                    <div class="item-quantity">${item.quantity}</div>
                    <div class="text-center"><span class="item-group">${item.group}</span></div>
                    <div>${item.details || '-'}</div>
                    <div class="text-right">
                        <button onclick="removeFromBatch('${item.id}')" class="btn btn-danger" style="padding: 4px 8px; font-size: 0.75rem;">‚ùå</button>
                    </div>
                </div>
            `).join('');
        }

        function updatePendingBatchesList() {
            const container = document.getElementById('pendingBatchesList');
            const section = document.getElementById('pendingBatchesSection');
            
            if (!isAdmin || pendingBatches.length === 0) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            
            container.innerHTML = pendingBatches.map(batch => {
                const date = new Date(batch.submittedAt).toLocaleString();
                return `
                    <div class="pending-batch">
                        <div class="pending-batch-header">
                            <div class="pending-batch-title">
                                üì¶ Batch #${batch.id.slice(-8)} - ${batch.items.length} items
                                <br>
                                <span style="font-size: 0.75rem; font-weight: normal; color: #64748b;">
                                    Submitted: ${date}
                                </span>
                            </div>
                            <div class="pending-batch-actions">
                                <button onclick="approveBatch('${batch.id}')" class="btn btn-success">‚úì Approve All</button>
                                <button onclick="rejectBatch('${batch.id}')" class="btn btn-danger">‚úó Reject All</button>
                            </div>
                        </div>
                        <div class="batch-table">
                            <div class="table-header">
                                <div>ITEM NAME</div>
                                <div class="text-center">QUANTITY</div>
                                <div class="text-center">GROUP</div>
                                <div>DETAILS</div>
                                <div class="text-right">ACTIONS</div>
                            </div>
                            ${batch.items.map(item => `
                                <div class="table-row">
                                    <div class="item-name editable" onclick="editBatchItem('${batch.id}', '${item.id}', 'name')" title="Click to edit">${item.name}</div>
                                    <div class="item-quantity editable" onclick="editBatchItem('${batch.id}', '${item.id}', 'quantity')" title="Click to edit">${item.quantity}</div>
                                    <div class="text-center"><span class="item-group editable" onclick="editBatchItem('${batch.id}', '${item.id}', 'group')" title="Click to edit">${item.group}</span></div>
                                    <div class="editable" onclick="editBatchItem('${batch.id}', '${item.id}', 'details')" title="Click to edit">${item.details || '-'}</div>
                                    <div class="text-right">
                                        <button onclick="removeBatchItem('${batch.id}', '${item.id}')" class="btn btn-danger" style="padding: 4px 8px; font-size: 0.75rem;">üóëÔ∏è</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateApprovedInventoryList() {
            const container = document.getElementById('approvedInventoryList');
            
            if (approvedInventory.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>No approved items yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = approvedInventory.map(item => `
                <div class="table-row">
                    <div class="item-name">${item.name}</div>
                    <div class="item-quantity">${item.quantity}</div>
                    <div class="text-center"><span class="item-group">${item.group}</span></div>
                    <div>${item.details || '-'}</div>
                    <div class="text-right">
                        <button onclick="deleteApprovedItem('${item.id}')" class="btn btn-danger" style="padding: 4px 8px; font-size: 0.75rem;">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            document.getElementById('currentBatchCount').textContent = `Current Batch: ${currentBatch.length} items`;
            document.getElementById('pendingBatchCount').textContent = `Pending: ${pendingBatches.length} batches`;
            document.getElementById('approvedCount').textContent = `Approved: ${approvedInventory.length} items`;
        }

        function updateAdminUI() {
            const adminBtn = document.getElementById('adminBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (isAdmin) {
                adminBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
            } else {
                adminBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
            }
        }

        function updateStatus(text, type) {
            const element = document.getElementById('connectionStatus');
            element.textContent = text;
            element.className = 'status-badge ' + (type === 'online' ? 'status-online' : 'status-offline');
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            document.getElementById('addBtn').addEventListener('click', addItemToBatch);
            
            document.getElementById('nameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') document.getElementById('quantityInput').focus();
            });
            
            document.getElementById('quantityInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') document.getElementById('groupInput').focus();
            });
            
            document.getElementById('groupInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') document.getElementById('detailsInput').focus();
            });
            
            document.getElementById('detailsInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addItemToBatch();
            });
            
            document.getElementById('clearBatchBtn').addEventListener('click', clearBatch);
            document.getElementById('submitBatchBtn').addEventListener('click', submitBatch);
            
            document.getElementById('adminBtn').addEventListener('click', () => {
                const password = prompt('Enter admin password:');
                if (password === CONFIG.ADMIN_PASSWORD) {
                    isAdmin = true;
                    showMessage('‚úÖ Admin logged in');
                    updateUI();
                } else if (password) {
                    showMessage('‚ùå Incorrect password');
                }
            });
            
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('Logout from admin?')) {
                    isAdmin = false;
                    showMessage('üëã Logged out');
                    updateUI();
                }
            });
            
            window.addEventListener('online', () => {
                isOnline = true;
                updateStatus('Online', 'online');
                if (githubToken) syncWithGitHub();
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateStatus('Offline', 'offline');
            });
        }

        // ============================================
        // MESSAGE FUNCTIONS
        // ============================================
        function showMessage(message) {
            const existing = document.querySelector('.message-toast');
            if (existing) existing.remove();
            
            const messageEl = document.createElement('div');
            messageEl.className = 'message-toast';
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: ${message.includes('‚úÖ') ? '#10b981' : message.includes('‚ùå') ? '#ef4444' : '#2563eb'};
                color: white;
                padding: 10px 20px;
                border-radius: 4px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                font-size: 0.875rem;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.style.animation = 'slideOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        if (messageEl.parentNode) {
                            messageEl.parentNode.removeChild(messageEl);
                        }
                    }, 300);
                }
            }, 3000);
        }

        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Make functions globally available
        window.removeFromBatch = removeFromBatch;
        window.approveBatch = approveBatch;
        window.rejectBatch = rejectBatch;
        window.editBatchItem = editBatchItem;
        window.removeBatchItem = removeBatchItem;
        window.deleteApprovedItem = deleteApprovedItem;
    </script>
</body>
</html>
            
            offlineQueue.push({
                type: 'approveBatch',
                batchId: batchId,
                items: batch.items
            });
            
            saveLocalData();
            updateUI();
            
            if (isOnline && githubToken) {
                await syncWithGitHub();
            }
            
            showMessage('‚úÖ Batch approved');
        }

        async function rejectBatch(batchId) {
            if (!confirm('Reject this entire batch?')) return;
            
            const batchIndex = pendingBatches.findIndex(b => b.id === batchId);
            if (batchIndex === -1) return;
            
            pendingBatches.splice(batchIndex, 1);
